import useBaseUrl from '@docusaurus/useBaseUrl';
import ThemedImage from '@theme/ThemedImage';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Laboratoire 14
* * *

## Mise en place d'un serveur DHCP avec Linux

## Pr√©alable(s)

- Avoir compl√©t√© le laboratoire # 13
- Lire la page [¬´ Cours 14 ¬ª](../15%20-%20Cours%2014%20-%20DHCP%20sous%20Linux/00-cours14.md) du site du cours


## Objectif(s)
- D√©ployer un premier serveur DHCP sous Linux

* * *
## Sch√©ma

<div style={{textAlign: 'center'}}>
    <ThemedImage
        alt="Sch√©ma"
        sources={{
            light: useBaseUrl('/img/Serveurs1/Laboratoire14_W.svg'),
            dark: useBaseUrl('/img/Serveurs1/Laboratoire14_D.svg'),
        }}
    />
</div>

* * *

## √âtapes de r√©alisation

Pour compl√©ter ce laboratoire, vous devez obligatoirement utiliser une passerelle qui n'offre pas de service DHCP, puisque nous en mettrons un en place. Vous pouvez r√©utiliser la passerelle que vous avez utiliser dans les laboratoires 11 & 12 sans probl√®me. Une fois votre passerelle bien en place, concentrons-nous sur notre serveur Linux.

## Mise en place du serveur

Utilisez le mod√®le de machine virtuelle sous Ubuntu Serveur 24.04 mis √† votre disposition pour √©viter l'installation compl√®te du serveur. Une fois la machine fonctionnelle, **vous devrez √©videmment vous configurer une adresse IP manuellement puisqu'au serveur DHCP ne fonctionne sur le r√©seau.** Configurez donc l'adresse <mark> 192.168.21.30 </mark>sur votre serveur.

## Installation et configuration du DHCP

Nous y voici. Lors des prochaines √©tapes, nous allons mettre en place notre service DHCP.

### T√©l√©chargement des paquets

Lancez la commande suivante pour amorcer le t√©l√©chargement des paquets:

```bash
sudo apt install kea-dhcp4-server -y
```

Une fois les paquets n√©cessaires t√©l√©charg√©s et install√©s, votre service devrait d√©marr√© automatiquement. Vous pouvez valider cela en entrant la commande suivante:

```bash
sudo systemctl status kea-dhcp-server.service
```

### Configuration du serveur DHCP

Le fichier de configuration initial du service DHCP comporte beaucoup d'informations dont nous n'aurons pas besoin. Nous allons repartir depuis un fichier vide. Renommez donc le fichier initial comme suit:

```bash
sudo mv /etc/kea/kea-dhcp4.conf /etc/kea/kea-dhcp4.conf.bkp
```

Cr√©ez un nouveau fichier de configuration avec votre √©diteur de texte pr√©f√©r√©.

:::tip
VIM supporte la syntaxe des fichiers JSON. √áa peut √™tre tr√®s utile dans notre cas üòâ. Pour activer la colorisation de la syntaxe, vous aurez deux commandes √† entrer dans VIM:
1. :syntax on
2. :set filetype=json

Si vous avez besoin de rappel concernant VIM, consultez [cette section.](../06%20-%20Cours%205%20-%20Quiz,%20Vim%20et%20temps%20de%20compl√©tion/00-cours5.md)
:::

```bash
sudo vim /etc/kea/kea-dhcp4.conf
```

Voici le contenu qu'il vous faut inscrire dans le fichier que vous venez de cr√©er. Je vous explique par la suite chacune des lignes:

```json title='/etc/kea/kea-dhcp4.conf' showLineNumbers
{
 "Dhcp4": {

    "interfaces-config": {
        "interfaces": [ "ens192" ]
    },

    "valid-lifetime": 259200,
    "renew-timer": 129600,
    "rebind-timer": 220320,
    "authoritative": true,

    "lease-database": {
        "type": "memfile",
        "persist": true,
        "name": "/var/lib/kea/kea-leases4.csv",
        "lfc-interval": 3600
    },
            "subnet4": [
            {
                "subnet": "192.168.21.0/24",
                "pools": [ { "pool": "192.168.21.100 - 192.168.21.200" } ],
                "option-data": [
                    {
                        "name": "routeurs",
                        "data": "192.168.21.1"
                    },
                    {
                        "name": "domain-name-servers",
                        "data": "192.168.21.1"
                    },
                    {
                        "name": "domain-search",
                        "data": "gabriel.local"
                    }
                ]
            }
        ]
    }
}
```

Le fichier contient beaucoup d'√©l√©ments certes, mais il contient surtout beaucoup de ponctuation, soyez donc tr√®s vigilants! D√©cortiquons l'ensemble des informations pr√©sent√©es ici ensemble.

La syntaxe du fichier JSON demande √† ce que tout soit entre accolades, c'est pourquoi nous retrouvons une accolade ouvrante d√®s la premi√®re ligne. Apr√®s quoi, nous retrouvons la d√©claration d'un bloc nomm√© `"Dhcp4"` qui contiendra toute l'information relative √† la configuration de notre service. Les deux accolades ouvertes ici sont referm√©es √† la toute fin du fichier:

```json
{
    "Dhcp4": {
        ...
        ...
        ...
        ...
    }
}
```

