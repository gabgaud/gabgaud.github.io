import useBaseUrl from '@docusaurus/useBaseUrl';
import ThemedImage from '@theme/ThemedImage';

# Cours 4

## Les serveurs physiques <FAIcon icon="fa-solid fa-server" size="1x"/>

Nous avons rÃ©cemment dÃ©fini ce qu'Ã©tait un serveur informatique en classe. Pour rappel, il s'agit d'un ordinateur offrant un ou plusieurs services sur le rÃ©seau. Ce n'est pas plus compliquÃ© que cela.

> *Â« Mais Gabriel, les serveurs informatiques c'est aussi de grosses machines puissantes et performantes non ? Â»*
>
> -Les Ã©tudiants

Oui, et non! Le besoin de puissance dÃ©pend directement de la charge de travail du serveur. Un serveur desservant 5 Ã  25 clients n'a pas besoin d'Ãªtre ultra-performant. En revanche, un serveur desservant plusieurs centaines de clients, voire des milliers de clients, devra possÃ©der la capacitÃ© d'y arriver. Cela passera, Ã©videmment, par la quantitÃ© de mÃ©moire, la puissance de calcul et la quantitÃ© de stockage. Certaines entreprises ont mÃªme besoin de plusieurs de ces machines puissantes pour opÃ©rer. Ces machines hautement performantes, on les appelle des serveurs physiques.

### R.A.S

Lorsque vous mettez en place un, ou des serveurs pour rÃ©pondre aux diffÃ©rents besoins d'une entreprise, gardez toujours en tÃªte ces trois lettres: R-A-S

- **R**eliability ( *FiabilitÃ©* )<br/>
    Le ou les serveurs que vous mettez en place doivent Ãªtre en mesure d'opÃ©rer de faÃ§on continue et en minimisant le risque d'erreur. L'intÃ©gritÃ© des donnÃ©es et des services offerts doit Ãªtre protÃ©gÃ©e Ã  tout prix.

- **A**vailability ( *DisponibilitÃ©* )<br/>
    Les consÃ©quences d'un service en Ã©chec doivent Ãªtre minimes ou inexistantes aux yeux des clients.

- **S**erviceability ( *Entretien* )<br/>
    Le temps d'intervention pour corriger un problÃ¨me et remettre le serveur opÃ©rationnel doit Ãªtre minime.

### Formats des serveurs physiques

On retrouve principalement trois formats de serveur physique sur le marchÃ©.

#### Serveurs de type tour

Le serveur de type Â« tour Â» ou Â« tower Â» est sans doute qui ressemble le plus Ã  un PC standard. Il possÃ¨de l'avantage de pouvoir accueillir plusieurs composantes d'extension (carte rÃ©seau supplÃ©mentaire, carte raid, etc.). Cela dit, le matÃ©riel dÃ©diÃ© aux serveurs physiques est gÃ©nÃ©ralement plus dispendieux que le matÃ©riel pour les PC standards.

![serveurtour](../Assets/04/serveurtour.avif)<br/>*ReprÃ©sentation d'un serveur de type tour*

#### Serveurs en Â« rack Â»

Le serveur en Â« rack Â», parfois appelÃ© Â« rackmount Â» sert principalement Ã  Ã©conomiser de l'espace (au pied carrÃ©). Ce type de serveur physique est facilement reconnaissable de par sa forme de boÃ®te Ã  pizza. Ce type de serveur physique est sans doute le plus populaire dans les entreprises et les centres de donnÃ©es. Ils sont installÃ©s dans des armoires mÃ©talliques standardisÃ©es de 19 pouces de large. Ces armoires sont conÃ§ues pour favoriser le passage des cÃ¢bles, la ventilation et l'alimentation Ã©lectrique.

![ServeurRackFront](../Assets/04/FrontViewServer.png)<br />*ReprÃ©sentation d'un serveur Â« rackmount Â» (face avant)*

![ServeurRackBack](../Assets/04/poweredge-r650-back.png)<br />*ReprÃ©sentation d'un serveur Â« rackmount Â» (face arriÃ¨re)*

:::tip[Le saviez-vous ?]
Avez-vous remarquÃ© que le serveur de l'image ci-dessus possÃ¨de deux blocs d'alimentation ? Vous l'aurez devinÃ©, c'est pour Ã©viter un arrÃªt de service si un bloc d'alimentation devient dÃ©fectueux. On parlera donc de redondance Ã©lectrique. 
> *Oui mais Gabriel, s'il y a une panne d'Ã©lectricitÃ©, on ne sera pas plus avancÃ© non ?*
>
Effectivement! C'est pourquoi les entreprises ont gÃ©nÃ©ralement des alimentations Ã©lectriques secondaires telles que des batteries de secours (ondulateurs) et parfois mÃªme des gÃ©nÃ©ratrices qui prendront le relais en cas de panne Ã©lectrique.
:::

##### Dimensions
Les serveurs en Â« rack Â» ont toujours la mÃªme largeur (19 pouces), mais leur hauteur ainsi que leur profondeur peuvent varier en fonction des composantes qu'ils comportent. MÃªme si la hauteur des serveurs en Â« rack Â» peut varier, celle-ci est tout de mÃªme normÃ©e. En effet, la hauteur d'un serveur de ce type est calculÃ©e en **U** ( *Rack Unit* ). 1U correspond Ã  une hauteur de 1,75 pouce. Un serveur de 2U aura donc une hauteur de 3,5 pouces, ainsi de suite.

![RackUnit](../Assets/04/RackUnit.png)

#### Serveurs en lame (blade)

Les serveurs en lame (blade) sont des serveurs conÃ§us pour limiter au maximum l'encombrement physique que causent les cÃ¢bles, les systÃ¨mes de refroidissement, les stockages, etc. Les serveurs sont enfichables dans un chÃ¢ssis qui regroupe certains Ã©lÃ©ments communs Ã  tous les serveurs:
 - Alimentation
 - Refroidissement
 - Connexions rÃ©seau
 - Stockage

 ![Blades](../Assets/04/HPE_Blades.png)

### Composantes internes

Les composantes internes d'un serveur sont *grosso modo* les mÃªmes que dans un PC standard. Cela dit, il y a certaines diffÃ©rences qu'il faut tout de mÃªme aborder.

#### Carte mÃ¨re

La carte mÃ¨re d'un serveur se distinguera de la carte mÃ¨re de PC par les Ã©lÃ©ments suivants:

- Elle possÃ¨de parfois plus d'un socle pour les processeurs.
- Elle comporte <u>beaucoup</u> de baies pour la mÃ©moire vive (8 ou +)
- Elle n'a que des ports de bases. Oubliez le port HDMI ou mÃªme la sortie audio.

![Mobo](../Assets/04/ServerMobo.png)<br/>*ReprÃ©sentation d'une carte mÃ¨re de serveur physique*

#### Processeur

GÃ©nÃ©ralement, les fabricants de processeurs (Intel et AMD) possÃ¨dent une classe de processeur rÃ©servÃ© aux serveurs physiques. Chez Intel, la sÃ©rie de processeurs [Xeon](https://www.intel.com/content/www/us/en/products/details/processors/xeon.html) est gÃ©nÃ©ralement rÃ©servÃ©e Ã  l'utilisation au sein de serveurs physiques. Quant Ã  AMD, c'est la sÃ©rie [EPYC](https://www.amd.com/en/products/processors/server/epyc.html) qui est utilisÃ©e pour les serveurs. Il serait assez facile de croire que les processeurs dÃ©diÃ©s aux serveurs physiques sont les plus puissants qui soient, mais ce n'est pas le cas. Pourquoi ? Parce qu'on veut de la performance dans nos serveurs, mais pas au prix de la stabilitÃ© du systÃ¨me. N'oubliez pas, les serveurs sont d'abord et avant tout lÃ  pour offrir un service de maniÃ¨re stable et rÃ©guliÃ¨re.

#### MÃ©moire vive

La mÃ©moire vive utilisÃ©e au sein des serveurs physiques bÃ©nÃ©ficie gÃ©nÃ©ralement de la technologie **ECC** (Error Correcting Code). C'est un type de mÃ©moire capable de dÃ©tecter et corriger les erreurs les plus courantes de corruption de donnÃ©es. MÃªme si cette mÃ©moire peut Ãªtre lÃ©gÃ¨rement plus lente quant au traitement des donnÃ©es, on la prÃ©fÃ©rera pour sa fiabilitÃ©.

:::tip[Le saviez-vous ?]
On reconnait gÃ©nÃ©ralement la mÃ©moire ECC simplement en la regardant puisqu'elle comporte une puce supplÃ©mentaire:
![Ecc](../Assets/04/pro-ram-ecc-non-ecc.png)
:::

#### Stockage interne

La grande majoritÃ© des serveurs physiques possÃ¨dent des baies de disque dur (emplacement Ã  l'intÃ©rieur du serveur) pour y installer du stockage. Les serveurs physiques peuvent possÃ©der des disques durs standards et des disques durs Ã©lectroniques Ã  travers une panoplie d'interfaces. Voici un tableau rÃ©capitulant les diffÃ©rentes interfaces possibles pour les stockages internes des serveurs physiques:

| **Interface** | **Type de pÃ©riphÃ©rique**             | **Vitesse maximale**             | **Utilisation principale**                                     | **CaractÃ©ristiques**                                                                 | **Image**       |
|---------------|--------------------------------------|----------------------------------|-----------------------------------------------------------------|---------------------------------------------------------------------------------------|-----------------|
| **SATA**      | Disques durs (HDD), SSD              | Jusqu'Ã  6 Gb/s (SATA III)        | Stockage de masse, serveurs standards, environnements non critiques | Facile Ã  utiliser, bon rapport qualitÃ©/prix, plus lent que SAS et NVMe.               | ![SATA Image](../Assets/04/sata.png)    |
| **SAS**       | Disques durs (HDD), SSD professionnels | Jusqu'Ã  12 Gb/s (SAS-3), 24 Gb/s (SAS-4) | Serveurs professionnels, stockage RAID, environnements exigeants | Plus rapide et fiable que SATA, topologie en chaÃ®ne pour plusieurs pÃ©riphÃ©riques.    | ![SAS Image](../Assets/04/sas.png)     |
| **NVMe**      | SSD haute performance                | Jusqu'Ã  32 Gb/s (PCIe 4.0), 64 Gb/s (PCIe 5.0) | Applications haute performance, bases de donnÃ©es, virtualisation | TrÃ¨s faible latence, performances extrÃªmement rapides, utilise le bus PCIe.           | ![NVMe Image](../Assets/04/nvme.png)    |
| **PCIe**      | SSD, cartes d'extension (RAID, NVMe) | Jusqu'Ã  64 Gb/s (PCIe 5.0)       | Stockage haute performance, ajout de cartes SSD ou RAID         | UtilisÃ© pour ajouter des pÃ©riphÃ©riques Ã  un serveur, offre des vitesses ultrarapides. | ![PCIe Image](../Assets/04/pcie.png)    |

#### RAID

RAID est un acronyme qui signifie *Redundant Array of Independent Disks*. C'est une technologie qui a Ã©tÃ© crÃ©Ã© Ã  l'origine pour assurer une redondance des donnÃ©es et augmenter les performances des disques durs. Pour arriver Ã  ses fins, le raid fera l'Ã©talonnage des donnÃ©es, des copies ainsi qu'un calcul de vÃ©rification.

##### RAID 0 - *Striping*

En RAID0, les donnÃ©es sont Ã©talonnÃ©es sur le disque. Cette faÃ§on de procÃ©der accÃ©lÃ¨re la vitesse de lecture et d'Ã©criture des donnÃ©es. Cependant, ce RAID n'assure aucune sÃ©curitÃ© quant Ã  la possible perte de donnÃ©es. Dans l'Ã©ventualitÃ© oÃ¹ l'un des disques durs tomberait en panne, toutes les donnÃ©es seraient perdues. ğŸ˜±
<div style={{textAlign: 'center'}}>
    <ThemedImage
        alt="SchÃ©ma"
        sources={{
            light: useBaseUrl('/img/Serveurs1/Raid0_W.gif'),
            dark: useBaseUrl('/img/Serveurs1/Raid0_D.gif'),
        }}
    />
</div>


##### RAID 1 - *Mirroring*
En RAID1, les donnÃ©es sont simplement copiÃ©es sur un second disque dur. Il n'y a absolument aucun gain au niveau des performances en lecture et Ã©criture, cependant comme les donnÃ©es sont conservÃ©es en double, celles-ci peuvent survivre Ã  la perte d'un disque dur.
<div style={{textAlign: 'center'}}>
    <ThemedImage
        alt="SchÃ©ma"
        sources={{
            light: useBaseUrl('/img/Serveurs1/Raid1_W.gif'),
            dark: useBaseUrl('/img/Serveurs1/Raid1_D.gif'),
        }}
    />
</div>

##### RAID 1 + 0 - *Mirroring + Striping*
Avec le RAID0 et le RAID1, on dirait qu'il faut choisir entre performances et sÃ©curitÃ©. Un choix que beaucoup redoutent puisque chacun de ces choix pourrait engendrer des consÃ©quences dÃ©sagrÃ©ables. Alors, pourquoi ne pas tenter de bÃ©nÃ©ficier des deux technologies en mÃªme temps ? C'est exactement ce Ã  quoi le RAID 1 + 0 ( aussi appelÃ© RAID10 ).
<div style={{textAlign: 'center'}}>
    <ThemedImage
        alt="SchÃ©ma"
        sources={{
            light: useBaseUrl('/img/Serveurs1/Raid10_W.gif'),
            dark: useBaseUrl('/img/Serveurs1/Raid10_D.gif'),
        }}
    />
</div>
On crÃ©e une grappe entre les disques 1 & 2 ainsi qu'une grappe entre les disques 3 & 4. Chacune de ces grappes utilisera la technologie RAID1. Puis on crÃ©era un RAID0 entre les deux grappes prÃ©cÃ©dentes. Les donnÃ©es seront donc traitÃ©es dans l'ordre suivant:
- Les donnÃ©es sont d'abord Ã©talonnÃ©es entre les deux grappes. 
- Les donnÃ©es sont ensuite copiÃ©es au sein de chaque grappe.

##### RAID 5 - *Striping avec paritÃ©*
Le RAID5 permet de bÃ©nÃ©ficier aussi de l'Ã©talonnage des donnÃ©es tout en les sÃ©curisant. Cela dit, le RAID 5 a sa propre mÃ©thodologie de fonctionnement. Au lieu d'effectuer une copie intÃ©grale des donnÃ©es, le RAID 5 utilise plutÃ´t ce que l'on nommera *la paritÃ©*. Cette technologie utilise un algorithme mathÃ©matique et en Ã©talonne le rÃ©sultat sur les disques durs. Ainsi, en cas de perte de l'un des disques durs, nous n'aurons qu'Ã  insÃ©rer un nouveau disque dur et le RAID sera en mesure de se reconstruire de par lui-mÃªme.

<div style={{textAlign: 'center'}}>
    <ThemedImage
        alt="SchÃ©ma"
        sources={{
            light: useBaseUrl('/img/Serveurs1/Raid5_W.gif'),
            dark: useBaseUrl('/img/Serveurs1/Raid5_D.gif'),
        }}
    />
</div>

##### DiffÃ©rences entre RAID 5 et 10

| CritÃ¨re                 | RAID 5                            | RAID 10                           |
|-------------------------|-----------------------------------|-----------------------------------|
| **Nombre de disques**    | Minimum 3                        | Minimum 4                        |
| **Redondance**           | ParitÃ© rÃ©partie                  | Mirroring (dupliquÃ©)             |
| **CapacitÃ© utilisable**      | (n - 1) * taille d'un disque     | 50% de la capacitÃ© totale        |
| **Performance en lecture**| TrÃ¨s bonne                       | Excellente                       |
| **Performance en Ã©criture**| Moyenne (calcul de paritÃ©)       | Excellente (pas de paritÃ©)       |
| **TolÃ©rance aux pannes** | 1 disque                         | 1 disque par miroir              |
| **CoÃ»t**                 | Moins cher (moins de disques)     | Plus cher (plus de disques)      |
| **ComplexitÃ©**           | ModÃ©rÃ© (calcul de paritÃ©)        | Simple (duplication)             |
| **IdÃ©al pour**           | Stockage de donnÃ©es avec lecture intensive | Applications nÃ©cessitant haute performance et sÃ©curitÃ© |

#### LVM - *Logical Volume Manager*

Le gestionnaire de volume logique est une technologie d'abstraction qui se situe entre les stockages physiques et ce que le systÃ¨me nous prÃ©sentera en termes de stockage. L'objectif ultime d'une structure LVM est d'apporter une plus grande flexibilitÃ© aux administrateurs dans la gestion des stockages sous Linux.

:::caution[RAID vs LVM]
La technologie RAID & LVM sont complÃ¨tement distinctes. Elles ne rÃ©pondent pas aux mÃªmes besoins et ne sont donc pas comparables. D'ailleurs, elles peuvent mÃªme Ãªtre complÃ©mentaire. Il est tout Ã  fait possible d'utiliser Ã  la fois RAID & LVM.
:::

##### Comment Ã§a fonctionne ?

Pour expliquer le fonctionne de LVM, il faut d'abord dÃ©finir certains Ã©lÃ©ments. Ensuite, je vous prÃ©senterai un schÃ©ma visuel pour que vous puissiez assembler les piÃ¨ces du casse-tÃªte.

- PV ( *Physical Volume* ):
Il s'agit des partitions physiques prÃ©sentes sur votre ou vos disques durs. Le terme *physical* dÃ©crit bien l'aspect bas-niveau de cet Ã©lÃ©ment.

- VG ( *Volume Group* ):
Les *Volume Groups* permettent d'assembler plusieurs partitions physiques ensemble, et ce, mÃªme si ces partitions se trouvent sur des disques durs distincts. Cela permet par exemple, de rassembler deux disques durs de 60Go dans un seul et mÃªme volume de 120Go.

- LV ( *Logical Volume* ):
C'est un espace que l'on peut dÃ©finir dans le groupe de volume sur lequel nous installerons un systÃ¨me de fichiers. Vous pouvez vous imaginer cet endroit comme l'Ã©quivalent d'une partition physique sans l'utilisation de LVM.

Voici un schÃ©ma qui vous permettra de mieux saisir comment le tout fonctionne:

<div style={{textAlign: 'center'}}>
    <ThemedImage
        alt="SchÃ©ma"
        sources={{
            light: useBaseUrl('/img/Serveurs1/LVM_W.png'),
            dark: useBaseUrl('/img/Serveurs1/LVM_D.png'),
        }}
    />
</div>

### Stockage externe

Outre les diffÃ©rents stockages internes qu'un serveur physique peut possÃ©der, il existe Ã©galement des technologies lui permettant d'exploiter des stockages externes. Attention, on ne parle pas simplement d'un disque dur USB mais bien de technologie plus avancÃ©e.

#### NAS

Le NAS ou *Network Attached Storage* est un type de serveur de fichiers sur lequel on y retrouve habituellement de la redondance, des sauvegardes programmÃ©es ainsi que des disques durs performants. Il prÃ©sente certains avantages intÃ©rÃ©ssants comme la centralisation des donnÃ©es ainsi que des moyens de sÃ©curiser ces derniÃ¨res. NÃ©anmoins, le NAS prÃ©sente certains inconvÃ©nients Ã©galement. Les donnÃ©es envoyÃ©es au NAS doivent transiger par le rÃ©seau, ce qui peut provoquer de l'achanladage sur celui-ci. De plus, la vitesse de transfert des donnÃ©es Ã  travers un rÃ©seau est souvent limitÃ©.

#### SAN

Le SAN ou *Storage Area Network* procure un accÃ¨s de bas niveau aux disques durs. Contrairement au NAS, oÃ¹ l'accÃ¨s aux fichiers passent par des partages de dossier et nÃ©cessite des services en place, le SAN est un accÃ¨s directe aux disques durs. Les serveurs sont reliÃ©s Ã  l'espace de stockage via un lien fibrÃ©, ce qui assure un accÃ¨s pratiquement instantannÃ©. Le SAN est plus performant que le NAS pratiquement en tout point. Cela dit, c'est un dispositif trÃ¨s dispendieux.

### Conditions d'opÃ©ration

Les serveurs physiques ne sont gÃ©nÃ©ralement pas entreposÃ©s n'importe oÃ¹ car ils ont besoin que certaines conditions soient respectÃ©s. En effet, les serveurs physiques auront des exigences en matiÃ¨re de:

- TempÃ©rature
- Ventilation
- Taux d'humiditÃ©
- SÃ©curitÃ© de l'accÃ¨s

#### TempÃ©rature
Les serveurs physiques sont des ordinateurs trÃ¨s puissants. ConsÃ©quemment, ils peuvent gÃ©nÃ©rer une grande quantitÃ© de chaleur. Il est primordiale de gÃ©rer cette chaleur puisqu'une tempÃ©rature trop Ã©levÃ© provoquera des erreurs et des risques importants de surchauffe ğŸ¥µ. *A contrario*, si nous conservons les serveurs dans un environnement trop froid, il risque d'y avoir de la condensation ğŸ’§ lorsque l'air froid entrera en contact avec l'air chaud produit par les serveurs. La clÃ© se situe donc dans l'Ã©quilibre. GÃ©nÃ©ralement, les salles oÃ¹ les serveurs physiques sont entreposÃ©s sont maintenues entre 18 et 27 degrÃ©s celsius.

#### Ventilation
Maintenir la tempÃ©rature est une premiÃ¨re Ã©tape, il faut aussi assurer une circulation d'air. Les serveurs en *rack* sont empilÃ©s les uns par dessus les autres, les ventiler comme il se doit peut donc s'avÃ©rer un dÃ©fi. Ce type de serveur expulse l'air chaud Ã  l'arriÃ¨re. On essaiera donc d'amener de l'air frais Ã  l'avant et de rÃ©cupÃ©rer l'air plus chaud Ã  l'arriÃ¨re.

![Airflow](../Assets/04/AirFlow.png)

#### HumiditÃ©
L'humiditÃ© de l'air influe aussi sur le fonctionnement et l'usure des serveurs. Un air trop humide peut engendrer de la corrosion et crÃ©er des court-circuits. Au contraire, un air trop sec encourage la crÃ©ation d'Ã©lectricitÃ© statique, ce qui peut Ã©videmment endommager les Ã©quipements. Dans la salle oÃ¹ les serveurs opÃ©rent, on essaiera de conserver une humiditÃ© relative en 40% et 60%.

#### AccÃ¨s et sÃ©curitÃ©
La salle oÃ¹ sont stockÃ©s les serveurs doit possÃ©der un accÃ¨s contrÃ´lÃ©. Plusieurs serveurs hÃ©bergent des services et des donnÃ©es critiques Ã  l'entreprise. Certainent entreprises dÃ©pendent littÃ©ralement de leurs services informatiques. L'accÃ¨s au serveur doit Ãªtre limitÃ© aux gens qualifiÃ©s. Un employÃ© inconsciemment des risques pourrait s'enfargÃ© dans des cÃ¢bles et provoques des dommages considÃ©rables sans nÃ©cessairement le vouloir.