import useBaseUrl from '@docusaurus/useBaseUrl';
import ThemedImage from '@theme/ThemedImage';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Cours 11

## Le stockage en virtualisation üíæ

Contrairement √† un ordinateur physique o√π vous avez un disque dur, dans Proxmox vous devez :

1. **D√©cider o√π** stocker vos VMs (quel disque physique ?)
2. **Choisir comment** les stocker (quel format ?)
3. **G√©rer l'espace** entre plusieurs VMs
4. **Pr√©voir les sauvegardes** et les snapshots
5. **Optimiser les performances** selon vos besoins

√Ä la fin de ce cours, vous saurez :
- **Comprendre** les diff√©rentes options de stockage
- **Choisir** la solution adapt√©e √† vos besoins
- **Configurer** le stockage correctement
- **R√©soudre** les probl√®mes courants

## LVM - *Logical Volume Manager*

Par d√©faut, Proxmox utilise la technologie `LVM` pour l'ensemble de ses stockages. `LVM` est une couche d'abstraction logicielle que l'on applique par dessus la configuration **r√©guli√®re** des disques durs. Sans `LVM`, une configuration avec deux disques dur pourraient ressembler √† ceci:

<div style={{textAlign: 'center'}}>
    <ThemedImage
        alt="Sch√©ma"
        sources={{
            light: useBaseUrl('/img/Virtu/disques_W.svg'),
            dark: useBaseUrl('/img/Virtu/disques_D.svg'),
        }}
    />
</div>

Avec `LVM`, on pourrait red√©couper le tout, sans se soucier des disques ou m√™me des partitions:

<div style={{textAlign: 'center'}}>
    <ThemedImage
        alt="Sch√©ma"
        sources={{
            light: useBaseUrl('/img/Virtu/LVM_W.svg'),
            dark: useBaseUrl('/img/Virtu/LVM_D.svg'),
        }}
    />
</div>

Dans une architecture `LVM`, les disques physiques sont appel√©s des **PV** (*Physical Volume*). Un regroupement de disques se nomme un **VG** (*Volume Group*). Attention, un **VG** n'est pas obligatoirement l'h√¥te de plusieurs disques durs. En effet, un **VG** peut contenir un seul disque. Les **LV** (*Logical Volume*), constituent les emplacements disponibles pour utilisation.

Le probl√®me avec la technologie `LVM` standard, c'est qu'elle ne supporte que le *Thick Provisionning*. Autrement dit, si vous d√©sirez octroyer un disque dur virtuel de 500Go √† une machinve virtuelle, il vous faudra bloquer 500Go d'espace disque physique. Ce n'est pas tr√®s pratique et encore moins optimal lorsqu'on parle d'environnement virtuel.

## LVM - *Thin*

Voil√†! La technologie *LVM-Thin* vient r√©pondre √† ce besoin, tout simplement √† l'aide d'un *pool* de stockage partag√©. Avec cette m√©thode, nous sommes capable de faire de l'allocation d'espace √† la demande (*Thin-Provisionning*) et m√™me de l'*over-provisionning*.

<div style={{textAlign: 'center'}}>
    <ThemedImage
        alt="Sch√©ma"
        sources={{
            light: useBaseUrl('/img/Virtu/LVM-Thin_W.svg'),
            dark: useBaseUrl('/img/Virtu/LVM-Thin_D.svg'),
        }}
    />
</div>

Dans le sch√©ma ci-dessus, vous remarquerez que le serveur Proxmox est √©quip√© de deux disques durs de 500Go. Or, 700Go ont √©t√© allou√©s au total aux diff√©rentes machines virtuelles. Il sera donc primordial de surveiller l'utilisation de l'espace disque physique pour √©viter des probl√®mes de corruptions et de manque d'espace.

## Par d√©faut

Voici comment est configur√© et d√©coup√© le stockage d'une installation Proxmox standard. Pour l'exemple, prenons un simple disque de 250Go:

```
SSD 250GB (sda)
‚îú‚îÄ‚îÄ Partition 1 : BIOS boot (1MB)
‚îú‚îÄ‚îÄ Partition 2 : Boot EFI (1GB) 
‚îî‚îÄ‚îÄ Partition 3 : LVM Proxmox (249GB)
    ‚îú‚îÄ‚îÄ Swap : 8GB
    ‚îú‚îÄ‚îÄ Syst√®me : 72GB  
    ‚îî‚îÄ‚îÄ Thin Pool : 150GB (pour vos VMs)
```